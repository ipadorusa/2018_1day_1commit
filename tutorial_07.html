<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="//www.saramin.co.kr/sri_css/layout.css?v=20171228_1" media="all" rel="stylesheet" type="text/css">
    <link href="//www.saramin.co.kr/sri_css/common_ui_keeping.css?v=20171228_1" media="all" rel="stylesheet" type="text/css">
    <link href="//www.saramin.co.kr/sri_css/components.css?v=20171228_1" media="all" rel="stylesheet" type="text/css">
    <link href="//www.saramin.co.kr/sri_css/salary.css?v=20171228_1" media="all" rel="stylesheet" type="text/css">
    <script src="./js/d3.min.js"></script>
    <style>
        #vertical_bar {
            border: 1px solid #ddd;
        }

        .bar {
            fill: steelblue;
        }

        .bar-label {
            font-family: sans-serif;
            font-size: 11px;
            fill: white;
        }
    </style>
</head>

<body>
    <div class="gwrap">
        <div class="chart" id="vbar"></div>
    </div>

    <p>
        <a id='chart_restore' href="javascript:">original</a>
        <a id='chart_randomize' href="javascript:">randomize original</a>
    </p>

    <script>
        var dataset = [
            5, 10, 13, 19, 21, 25, 22, 18,
            11, 12, 15, 20, 18, 17, 16, 18
        ];

        // Margins
        var margin = { top: 20, right: 20, bottom: 20, left: 20 };

        // Drawing area = svg dimensions - margins
        var w = 600 - margin.left - margin.right;
        var h = 400 - margin.top - margin.bottom;

        var xScale = d3.scaleBand()
            .domain(d3.range(dataset.length))
            .rangeRound([0, w])
            .padding(0.05);

        var yScale = d3.scaleLinear()
            .domain([0, d3.max(dataset)])
            .range([h, 0]);

        var hScale = d3.scaleLinear()
            .domain([0, d3.max(dataset)])
            .range([0, h]);

        var svg = d3.select('#vbar').append('svg')
            .attr('width', w)
            .attr('height', h);

        function update_chart(arr) {
            // nodes to modify   
            var bars = svg.selectAll('rect')
                .data(arr)
                .attr('x', function (d, i) { return xScale(i); })
                .attr('y', function (d) { return yScale(d); })
                .attr('width', xScale.bandwidth())
                .attr('height', function (d) { return hScale(d); })

            // nodes to add
            bars.enter().append('rect')
                .attr("x", function (d, i) { return xScale(i); })
                .attr("y", function (d) { return yScale(d); })
                .attr("width", xScale.bandwidth())
                .attr("height", function (d) { return hScale(d); })
                .attr('class', 'bar');

            // nodes to remove
            bars.exit().remove();

            // nodes to modify
            var labels = svg.selectAll("text")
                .data(arr)
                //.transition()   // interpolate over time
                //.duration(1000) // ms
                .text(function (d) { return d; })
                .attr('class', 'bar-label')
                .attr('x', function (d, i) {
                    // x-pos of bar + (bar width) / 2
                    return xScale(i) + xScale.bandwidth() / 2;
                })
                .attr('y', function (d) { return yScale(d) + 14; });

            // nodes to add
            labels.enter().append('text')
                .text(function (d) { return d; })
                .attr('class', 'bar-label')
                // center text horizontally at assigned x value
                .attr("text-anchor", "middle")
                .attr('x', function (d, i) {
                    // x-pos of bar + (bar width) / 2
                    return xScale(i) + xScale.bandwidth() / 2;
                })
                .attr('y', function (d) { return yScale(d) + 14; });

            // nodes to remove
            labels.exit().remove();
        }

        d3.select('#chart_randomize').on('click', function () {
            var arr = dataset.concat().sort(function () {
                return Math.random() - .5;
            });

            xScale.domain(d3.range(arr.length));
            update_chart(arr);
        });

        d3.select('#chart_restore').on('click', function () {
            xScale.domain(d3.range(dataset.length));
            update_chart(dataset);
        });

        update_chart(dataset);

    </script>
</body>

</html>